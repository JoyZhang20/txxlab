<html lang="en">

<head>
    <meta charset="UTF-8">
    <script>
        function imageFusion() {
            var canvas1 = document.getElementById("myCanvas1");
            var image1 = document.getElementById("imageSource1");
            canvas1.width = image1.width;
            canvas1.height = image1.height;
            var context = canvas1.getContext("2d");
            context.drawImage(image1, 0, 0);
            var canvasData = context.getImageData(0, 0, 500, 300);


            var canvas2 = document.getElementById("myCanvas2");
            var image2 = document.getElementById("imageSource2");
            canvas2.width = image2.width;
            canvas2.height = image2.height;
            var context2 = canvas2.getContext("2d");
            context2.drawImage(image2, 0, 0);
            var canvasData2 = context2.getImageData(0, 0, 500, 300);

            // gray filter  
            for (var x = 0; x < canvasData.width; x++) {
                for (var y = 0; y < canvasData.height; y++) {
                    // Index of the pixel in the array  
                    var idx = (x + y * canvasData.width) * 4;
                    var r = canvasData.data[idx + 0]*0.5+canvasData2.data[idx + 0]*0.5;
                    var g = canvasData.data[idx + 1]*0.5+canvasData2.data[idx + 1]*0.5;
                    var b = canvasData.data[idx + 2]*0.5+canvasData2.data[idx + 2]*0.5;
                    canvasData.data[idx + 0] = r; // Red channel  
                    canvasData.data[idx + 1] = g; // Green channel  
                    canvasData.data[idx + 2] = b; // Blue channel  
                    canvasData.data[idx + 3] = 255; // Alpha channel  
                }
            }
            context.putImageData(canvasData, 0, 0); // at coords 0,0
            document.querySelector("#delete").innerHTML=""

        }

        //图像灰度化
        function imageGraying() {
            var canvas = document.getElementById("myCanvas1");
            var image = document.getElementById("imageSource1");
            canvas.width = image.width;
            canvas.height = image.height;
            var context = canvas.getContext("2d");
            context.drawImage(image, 0, 0);
            var canvasData = context.getImageData(0, 0, 500, 300);
            for (var x = 0; x < canvasData.width; x++) {
                for (var y = 0; y < canvasData.height; y++) {
                    var idx = (x + y * canvasData.width) * 4;
                    var r = canvasData.data[idx + 0];
                    var g = canvasData.data[idx + 1];
                    var b = canvasData.data[idx + 2];
                    var gray = 0.3 * r + 0.6 * g + 0.1 * b;
                    canvasData.data[idx + 0] = gray; // Red channel  
                    canvasData.data[idx + 1] = gray; // Green channel  
                    canvasData.data[idx + 2] = gray; // Blue channel  
                    canvasData.data[idx + 3] = 255; // Alpha channel  
                }
            }
            context.putImageData(canvasData, 0, 0); // at coords 0,0  
        };


    </script>
</head>

<body>
    <img id='imageSource1' src='image1.jpg' alt='Canvas Source'>
    <img id='imageSource2' src='image2.jpg' alt='Canvas Source'>
    <br/>
    <input type="button" onclick="imageGraying()" value="图像灰度化">
    <input type="button" onclick="imageFusion()" value="图像融合">
    <br/>
    <canvas id="myCanvas1">Gray Filter</canvas>
    <div id="delete">
    <canvas id="myCanvas2">Gray Filter</canvas>
</div>

</body>

</html>
